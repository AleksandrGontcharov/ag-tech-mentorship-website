"use strict";(globalThis.webpackChunkag_tech_mentoring=globalThis.webpackChunkag_tech_mentoring||[]).push([[4550],{6783:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>d,frontMatter:()=>i,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"specialized-topics/networking/networking-syllabus","title":"\ud83d\udcdcNetworking Syllabus","description":"In this exercise you\'ll be pretending to be a network admin and will need setup some very typical network configurations from scratch. You\'ll have to deal with failures on every 2nd step and through troubleshooting of those failures you learn all the fundamentals.","source":"@site/docs/specialized-topics/networking/networking-syllabus.md","sourceDirName":"specialized-topics/networking","slug":"/specialized-topics/networking/networking-syllabus","permalink":"/ag-tech-mentorship-website/docs/specialized-topics/networking/networking-syllabus","draft":false,"unlisted":false,"editUrl":"https://github.com/AleksandrGontcharov/ag-tech-mentorship/blob/master/docs/specialized-topics/networking/networking-syllabus.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Specialized Topics"},"next":{"title":"\u2705Progress","permalink":"/ag-tech-mentorship-website/docs/specialized-topics/networking/progress"}}');var o=t(4848),s=t(8453);const i={sidebar_position:1},l="\ud83d\udcdcNetworking Syllabus",a={},c=[];function h(e){const n={a:"a",code:"code",em:"em",h1:"h1",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"networking-syllabus",children:"\ud83d\udcdcNetworking Syllabus"})}),"\n",(0,o.jsx)(n.p,{children:"In this exercise you'll be pretending to be a network admin and will need setup some very typical network configurations from scratch. You'll have to deal with failures on every 2nd step and through troubleshooting of those failures you learn all the fundamentals."}),"\n",(0,o.jsx)(n.p,{children:"You should do that sequentially (order is intentionally chosen) and can choose to stop any time without feeling bad about it - most people actually don't go to Anycast/BGP parts"}),"\n",(0,o.jsx)(n.p,{children:"As you do things I advise to capture some key learnings, conclusions or even snippets of concrete commands right in this document using different font or color, as you do things. Try to keep it compressed. You'll realize that this will be a useful document for you to return later at some point for hints or instructions on how to do something."}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Create 3 networks (private virtual switches in Hyper-V) without DHCP: Red, Green, Blue"}),"\n",(0,o.jsxs)(n.li,{children:["Create 6 VMs ",(0,o.jsx)(n.code,{children:"{red,green,blue}-{a,b}"})," [e.g. red-a, red-b, green-a,\u2026.]","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Use UI-less (server) ubuntu SKU (choose last LTS)"}),"\n",(0,o.jsxs)(n.li,{children:["Verify that they indeed ",(0,o.jsx)(n.strong,{children:"fail"})," to acquire IP address, as there's no DHCP"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:['Create 1 VM "router"',"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Have 4 NICS attached to this VM","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"3 pointing to red/green/blue networks---"}),"\n",(0,o.jsxs)(n.li,{children:["4th - direct ethernet access of your home network","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"You should get auto-assigned IP address here in the same subnet as your host machine"}),"\n",(0,o.jsx)(n.li,{children:"Do NOT use NAT and/or host-only networking"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Install open-source (preferably from ISC) dhcp server on the router (dhcpd)","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Allocate thee different subnets for your networks and configure dhcp server to allocate IPs for other VMs"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:"Configure routing on the router to ensure that VMs from each network can access other networks"}),"\n",(0,o.jsx)(n.li,{children:"Configure NAT (specifically SNAT) on the router so VMs can reach internet. U can use 8.8.8.8 as a DNS server for now (Google's public dns) or your ISP dns (or your home router)"}),"\n",(0,o.jsx)(n.li,{children:"Use iptables to block internet access for the red network"}),"\n",(0,o.jsx)(n.li,{children:"Use your iptables policy to deny(or drop) -by default and use explicit allow-listing for everything. Ensure everything continues to work (DHCP, SNAT, etc)."}),"\n",(0,o.jsx)(n.li,{children:"Experiment with various Iptables rules by allowing/disallowing routing between RED/BLUE/GREEN network and verify if it is working but leave that in a state where it is allowed by explicit rules."}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.em,{children:"Install your own DNS server on router VM (with recursive mode) on router and update dhcp to use this one"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.em,{children:"Configure DNS server to host three domains .red .blue .green so each VM gets a host name within these domains. Use DHCP to communicate domain name suffix for each VMs. Ensure that DNS server is forwarding traffic to the internet to be able to resolve hosts like"})," ",(0,o.jsx)(n.a,{href:"http://www.microsoft.com/",children:(0,o.jsx)(n.em,{children:"www.microsoft.com"})})," ",(0,o.jsx)(n.em,{children:"from your blue/red/green networks."}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Bonus point \u2013 (optional) find a way how to ensure that hosts in a red network can resolve ",(0,o.jsx)(n.code,{children:"*.{green,red,blue}"})," names but can't resolve internet hostnames"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Simulate ARPOISON attack.","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Learn how to use arp tool, run it on various vms to inspect state of local ARP cache."}),"\n",(0,o.jsx)(n.li,{children:"Add third Evil-VM in GREEN network"}),"\n",(0,o.jsx)(n.li,{children:"Learn how to use arping tool on Evil-VM."}),"\n",(0,o.jsxs)(n.li,{children:["Mount arpoinson attack on Evil-VM so you can intercept traffic between TWO other green VMs","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Try to script arpoison attack yourself, without using C sources \u2013 by running arping in a loop in a shell script (if that's possible)"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Mount arpoison attack in such a way that both router and two other VMs have poisoned ARP cache leading to resolving all addresses to the Evil-VM.","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Ensure that Evil-VM can see all the traffic"}),"\n",(0,o.jsx)(n.li,{children:"Figure out how to configure Evil-VM such that everything continues to work, traffic flows (except that it is maybe slower) and green VMs + router do not suspect that the traffic is routed through the evil VM."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Move your DNS and DHCP server to the VMs in the blue network.","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:'You\'d need to use "DHCP relay agent" aka "DHCP forwarder" to operate on the router'}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Install nginx HTTP server into the red network serving simplest static hello-world page. Make this server externally accessible from the internet (so I can hit it).","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"You'd need to configure DNAT for specific port on your router VM and yet another DNAT on your cable modem."}),"\n",(0,o.jsx)(n.li,{children:"This will only work if your modem has that feature (might be called port forwarding or port mapping) and if your ISP gives you a globally routable IP address."}),"\n",(0,o.jsx)(n.li,{children:"Note that we want this to be accessible from internet and simultaneously preserve the restriction introduced above so red network can't initiate outbound traffic from the internet."}),"\n",(0,o.jsx)(n.li,{children:"Read about connection state tracking in iptables."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:"SSH to internal servers via router"}),"\n",(0,o.jsxs)(n.li,{children:["Create a small-sku VM in Azure with globally routable IP address","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Ensure you have SSH server running there accessible from your home network"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:"Install openvpn server into Azure-VM on so you can connect from your home network and have internet access hiding your home IP address."}),"\n",(0,o.jsxs)(n.li,{children:["Modify router VM by installing openvpn client there to connect to Azure-VM and route/NAT every outgoing internet traffic to the Azure-VM so when you ping from BLUE net to ",(0,o.jsx)(n.a,{href:"http://www.microsoft.com/",children:"www.microsoft.com"})," the latter sees the Azure-VM address."]}),"\n",(0,o.jsx)(n.li,{children:"Create alternative tunnel impl. Using socat on both sides of tunnel"}),"\n",(0,o.jsxs)(n.li,{children:["Forget about both openvpn and assume for now there's no way to do ingress into your home network from internet. Bypass this limitation with following","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Install ssh server on one of the VMs in BLUE network."}),"\n",(0,o.jsx)(n.li,{children:'Create "reverse ssh" flow so you can connect from Azure-VM into the BLUE network.'}),"\n",(0,o.jsxs)(n.li,{children:['Using that reverse SSH create port forwarding which would allow you to run "curl ',(0,o.jsx)(n.a,{href:"http://localhost:8080/",children:"http://localhost:8080"}),'" on azure VM and reach your nginx webserver in the RED network.']}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:"Optional: configure boot server as part of DHCP, try to bring up VM that uses network boot to install OS"}),"\n",(0,o.jsxs)(n.li,{children:["Anycast UDP. We pretend now that red, green, and blue are different geo-regions. We'll place the same IP address 42.42.42.42 in each of the region intentionally violating constraint of uniqueness of globally-routable IP address. By doing this we will mimic how Googe's public DNS server with ip address 8.8.8.8 is setup as well as how things like ATM (Azure Traffic Manager) or Global CDNs work.","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Reconfigure 1 green VM, 1red and 1 one blue to have static IP address, configure secondary static IP address 42.42.42.42 on the NIC for each VM."}),"\n",(0,o.jsx)(n.li,{children:"You'll have therefore 3 machines with non-unique IP address 42.42.42.42."}),"\n",(0,o.jsx)(n.li,{children:'Launch some simple UDP server on port 1234 on each of those VMs bound exlusively to the IP address 42.42.42.42. Make sure it responds with VM name. You don\'t need to write new code. You can use "socat" tool. Learn how to use it it\'s a "swiss army knife" even more powerful than NetCat (aka nc).'}),"\n",(0,o.jsx)(n.li,{children:"Configure router VM such as if someone tries to route to the 42.42.42.42 it can route traffic to ANY of the machines. (anycast rounting) Validate this by connecting with netcat/nc tool or socat tool from your home network to ip address 42.42.42.42:1234 which is routed to your router - you should get different responses since you should be reaching different VMs."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["BGP routing (optional, hard). Goal \u2013 understand what makes Internet the internet and how traffic is routed at a global level.","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Read about BGP."}),"\n",(0,o.jsx)(n.li,{children:"Turn red/green/blue network into simulated Autonomous Systems (AS)"}),"\n",(0,o.jsxs)(n.li,{children:['Add "yellow" AS, and connect it directly to the green and blue, but not red.',"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Three will be 3 routers therefore, one existing router-vm (router1), with following connectivity","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"green<->router1, red<->router1, blue<-> router1"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["And 2 more routers. You can turn existing VMs with static Ips in green and blue into routers by adding additional nic.","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"yellow<->router2, green<->router2"}),"\n",(0,o.jsx)(n.li,{children:"yellow<->router3, blue<->router3"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:"Draw a topology manually and observe that there's bunch of alternate routes"}),"\n",(0,o.jsx)(n.li,{children:"Ensure that routing works automatically via BGP and you don't need to touch router1 when adding router23"}),"\n",(0,o.jsx)(n.li,{children:"Since there's multiple paths between some of the VMs via different routers, they can be exploited if one of the router fails. Simulate the failure by shutting down the router and ensure re-routing happens."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>l});var r=t(6540);const o={},s=r.createContext(o);function i(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);